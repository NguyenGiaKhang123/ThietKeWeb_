<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Trang Qu·∫£n Tr·ªã - B√°o 247</title>
    <style>
        body { font-family: sans-serif; padding: 20px; max-width: 1200px; margin: 0 auto; background: #f4f4f4; }
        h2 { border-bottom: 2px solid #28a745; padding-bottom: 10px; color: #333; margin-top: 0; }
        
        /* Layout chia 3 c·ªôt: ƒêƒÉng b√†i | Qu·∫£n l√Ω B√†i vi·∫øt | Qu·∫£n l√Ω User */
        .container { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px; }
        .box { background: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); height: 700px; overflow-y: auto; }

        /* Form styles */
        input, textarea, select { width: 100%; margin-bottom: 10px; padding: 8px; box-sizing: border-box; border: 1px solid #ddd; border-radius: 4px; }
        button.btn-post { width: 100%; padding: 10px; background: #28a745; color: white; border: none; cursor: pointer; font-weight: bold; border-radius: 4px; }
        button.btn-post:hover { background: #218838; }

        /* List styles */
        .list-item { border-bottom: 1px solid #eee; padding: 10px 0; display: flex; justify-content: space-between; align-items: flex-start; }
        .item-info h4 { margin: 0 0 5px 0; font-size: 14px; color: #333; }
        .item-info span { font-size: 11px; color: #888; background: #eee; padding: 2px 6px; border-radius: 3px; margin-right: 5px; }
        
        /* User List Specifics */
        .user-info p { margin: 2px 0; font-size: 12px; color: #555; }
        .user-pass { font-family: monospace; color: #d63384; background: #fdf2f8; padding: 2px 4px; border-radius: 3px; }

        .btn-delete { background: #dc3545; color: white; border: none; padding: 5px 10px; cursor: pointer; border-radius: 4px; font-size: 12px; margin-left: 10px; height: fit-content; }
        .btn-delete:hover { background: #c82333; }
    </style>
</head>
<body>

<h1 style="text-align:center; color:#333;">DASHBOARD QU·∫¢N TR·ªä</h1>

<div class="container">
    <div class="box">
        <h2>‚úçÔ∏è ƒêƒÉng b√†i m·ªõi</h2>
        <label>Ti√™u ƒë·ªÅ:</label>
        <input type="text" id="title" placeholder="Nh·∫≠p ti√™u ƒë·ªÅ...">
        
        <label>T√≥m t·∫Øt:</label>
        <textarea id="summary" rows="3" placeholder="T√≥m t·∫Øt ng·∫Øn..."></textarea>
        
        <label>Chuy√™n m·ª•c:</label>
        <select id="category">
            <option value="thoisu">Th·ªùi s·ª±</option>
            <option value="thegioi">Th·∫ø gi·ªõi</option>
            <option value="kinhdoanh">Kinh doanh</option>
            <option value="congnghe">C√¥ng ngh·ªá</option>
            <option value="thethao">Th·ªÉ thao</option>
            <option value="giaitri">Gi·∫£i tr√≠</option>
            <option value="suckhoe">S·ª©c kh·ªèe</option>
            <option value="giaoduc">Gi√°o d·ª•c</option>
            <option value="dulich">Du l·ªãch</option>
            <option value="gocnhin">G√≥c nh√¨n</option>  
            <option value="thugian">Th∆∞ gi√£n</option>
        </select>

        <label>Link ·∫£nh:</label>
        <input type="text" id="imageUrl" placeholder="https://...">
        
        <label>N·ªôi dung:</label>
        <textarea id="content" rows="8" placeholder="N·ªôi dung b√†i vi·∫øt..."></textarea>
        
        <button class="btn-post" onclick="dangBai()">ƒêƒÇNG B√ÄI</button>
    </div>

    <div class="box">
        <h2 style="border-color:#007bff;">newspaper Qu·∫£n l√Ω B√†i vi·∫øt</h2>
        <div id="article-list">ƒêang t·∫£i...</div>
    </div>

    <div class="box">
        <h2 style="border-color:#dc3545;">users Qu·∫£n l√Ω T√†i kho·∫£n</h2>
        <div id="user-list">ƒêang t·∫£i...</div>
    </div>
</div>

<script>
const API_URL = 'http://localhost:4000/api';

// --- PH·∫¶N 1: QU·∫¢N L√ù B√ÄI VI·∫æT ---

async function dangBai() {
    const dataToSend = {
        title: document.getElementById('title').value,
        summary: document.getElementById('summary').value,
        category: document.getElementById('category').value,
        content: document.getElementById('content').value,
        image_url: document.getElementById('imageUrl').value
    };

    if(!dataToSend.title) return alert("Vui l√≤ng nh·∫≠p ti√™u ƒë·ªÅ!");

    try {
        const res = await fetch(`${API_URL}/add-article`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(dataToSend)
        });

        if (res.ok) {
            alert("‚úÖ ƒêƒÉng b√†i th√†nh c√¥ng!");
            document.getElementById('title').value = "";
            document.getElementById('summary').value = "";
            document.getElementById('content').value = "";
            document.getElementById('imageUrl').value = "";
            taiDanhSachBaiViet();
        } else {
            alert("L·ªói server!");
        }
    } catch (e) { console.error(e); }
}

async function taiDanhSachBaiViet() {
    try {
        const res = await fetch(`${API_URL}/articles`);
        const articles = await res.json();
        
        const listDiv = document.getElementById('article-list');
        
        if(articles.length === 0) {
            listDiv.innerHTML = '<p>Ch∆∞a c√≥ b√†i vi·∫øt n√†o.</p>';
            return;
        }

        let html = '';
        articles.forEach(art => {
            html += `
                <div class="list-item">
                    <div class="item-info">
                        <h4>${art.title}</h4>
                        <span>${art.category}</span> <span style="color:#aaa">ID: ${art.id}</span>
                    </div>
                    <button class="btn-delete" onclick="xoaBai(${art.id})">X√≥a</button>
                </div>
            `;
        });
        listDiv.innerHTML = html;
    } catch (e) { console.error(e); }
}

async function xoaBai(id) {
    if(!confirm("X√≥a b√†i vi·∫øt n√†y?")) return;
    try {
        const res = await fetch(`${API_URL}/delete-article/${id}`, { method: 'DELETE' });
        if (res.ok) { alert("ƒê√£ x√≥a!"); taiDanhSachBaiViet(); }
    } catch (e) { alert("L·ªói k·∫øt n·ªëi!"); }
}

// --- PH·∫¶N 2: QU·∫¢N L√ù USER (M·ªöI) ---

async function taiDanhSachUser() {
    try {
        // G·ªçi API l·∫•y danh s√°ch User
        const res = await fetch(`${API_URL}/users`);
        const users = await res.json();
        
        const listDiv = document.getElementById('user-list');
        
        if(users.length === 0) {
            listDiv.innerHTML = '<p>Ch∆∞a c√≥ th√†nh vi√™n n√†o.</p>';
            return;
        }

        let html = '';
        users.forEach(u => {
            html += `
                <div class="list-item">
                    <div class="item-info user-info">
                        <h4>${u.username} <span style="background:#eee; color:#666;">ID: ${u.id}</span></h4>
                        <p>üìß Email: ${u.email}</p>
                        <p>üîë Pass: <span class="user-pass">${u.password}</span></p>
                    </div>
                    <button class="btn-delete" onclick="xoaUser(${u.id})">X√≥a</button>
                </div>
            `;
        });
        listDiv.innerHTML = html;
    } catch (e) { 
        console.error(e);
        document.getElementById('user-list').innerHTML = '<p style="color:red">L·ªói t·∫£i danh s√°ch User (C·∫ßn th√™m API v√†o server.js)</p>';
    }
}

async function xoaUser(id) {
    if(!confirm("C·∫¢NH B√ÅO: B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a vƒ©nh vi·ªÖn t√†i kho·∫£n n√†y?")) return;
    try {
        // D√πng l·∫°i API x√≥a user ƒë√£ c√≥ ·ªü server.js
        const res = await fetch(`${API_URL}/user/delete/${id}`, { method: 'DELETE' });
        if (res.ok) { 
            alert("ƒê√£ x√≥a t√†i kho·∫£n th√†nh c√¥ng!"); 
            taiDanhSachUser(); // Load l·∫°i danh s√°ch
        } else {
            alert("L·ªói khi x√≥a!");
        }
    } catch (e) { alert("L·ªói k·∫øt n·ªëi!"); }
}

// KH·ªûI CH·∫†Y C·∫¢ 2 DANH S√ÅCH
taiDanhSachBaiViet();
taiDanhSachUser();

</script>

</body>
</html>